<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>GTEC - Engenharia Clínica</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      color: #222;
    }
    header {
      background: #0b5ed7;
      color: #fff;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 {
      margin: 0;
      font-size: 20px;
    }
    .btn {
      background: #ffffff;
      color: #0b5ed7;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .btn:hover {
      background: #e9eef6;
    }

    .container {
      display: flex;
      min-height: calc(100vh - 56px);
    }
    nav {
      width: 220px;
      background: #ffffff;
      border-right: 1px solid #ddd;
      padding: 12px;
    }
    nav h3 {
      margin-top: 0;
      font-size: 16px;
      color: #444;
    }
    nav button {
      width: 100%;
      margin-bottom: 8px;
    }
    main {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
    }

    .hidden {
      display: none;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }
    .grid.cols-2 {
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .card h2, .card h3 {
      margin-top: 0;
    }

    .muted {
      color: #777;
      font-size: 14px;
    }

    .kpis {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
    }
    .kpi {
      background: #f0f4fa;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
    }
    .kpi .t {
      font-size: 13px;
      color: #555;
    }
    .kpi .v {
      font-size: 22px;
      font-weight: bold;
      margin-top: 4px;
      color: #0b5ed7;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th, td {
      border-bottom: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #f1f3f6;
    }

    select, input, textarea {
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    label {
      font-weight: bold;
      font-size: 14px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
    }
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    footer {
      text-align: center;
      font-size: 12px;
      color: #777;
      margin-top: 16px;
    }
  </style>
</head>
<body>

<header>
  <h1>GTEC - Engenharia Clínica</h1>
  <button class="btn" onclick="openGemini()">Chat-Gemini</button>
</header>

<div class="container">
  <nav>
    <h3>Menu</h3>
    <button class="btn" onclick="showPage('registros')">Registros</button>
    <button class="btn" onclick="showPage('dash-geral')">Dashboard Geral</button>
    <button class="btn" onclick="showPage('dash-hospital')">Dashboard por Hospital</button>
  </nav>

  <main>

    <!-- ===================== REGISTROS ===================== -->
    <section id="page-registros">
      <div class="grid">
        <div class="card">
          <h2>Novo Registro</h2>
          <form id="formRegistro">
            <div class="form-grid">
              <div class="form-group">
                <label>Hospital</label>
                <input type="text" id="hospital" required />
              </div>
              <div class="form-group">
                <label>Setor</label>
                <input type="text" id="setor" required />
              </div>
              <div class="form-group">
                <label>Status</label>
                <select id="status" required>
                  <option value="Em andamento">Em andamento</option>
                  <option value="Em validação">Em validação</option>
                  <option value="Tramitado">Tramitado</option>
                  <option value="Pendente">Pendente</option>
                </select>
              </div>
              <div class="form-group">
                <label>Criticidade</label>
                <select id="criticidade" required>
                  <option value="Baixa">Baixa</option>
                  <option value="Média">Média</option>
                  <option value="Alta">Alta</option>
                </select>
              </div>
              <div class="form-group">
                <label>Responsável</label>
                <input type="text" id="responsavel" required />
              </div>
              <div class="form-group">
                <label>Descrição</label>
                <textarea id="descricao" rows="2"></textarea>
              </div>
            </div>
            <br />
            <button type="submit" class="btn">Salvar Registro</button>
          </form>
        </div>

        <div class="card">
          <h2>Registros Salvos</h2>
          <table>
            <thead>
              <tr>
                <th>Hospital</th>
                <th>Setor</th>
                <th>Status</th>
                <th>Criticidade</th>
                <th>Responsável</th>
                <th>Descrição</th>
              </tr>
            </thead>
            <tbody id="tbodyRegistros"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ===================== DASH GERAL ===================== -->
    <section id="page-dash-geral" class="hidden">
      <div class="grid">
        <div class="card">
          <h2>Dashboard Geral</h2>
          <p class="muted">Visão geral dos processos do GTEC.</p>

          <div class="kpis" style="margin-top:10px;">
            <div class="kpi"><div class="t">Total</div><div class="v" id="k_total">0</div></div>
            <div class="kpi"><div class="t">Tramitados</div><div class="v" id="k_tram">0</div></div>
            <div class="kpi"><div class="t">Em andamento</div><div class="v" id="k_and">0</div></div>
            <div class="kpi"><div class="t">Em validação</div><div class="v" id="k_val">0</div></div>
            <div class="kpi"><div class="t">Pendentes</div><div class="v" id="k_pend">0</div></div>
          </div>
        </div>

        <div class="grid cols-2">
          <div class="card">
            <h3>Distribuição por Status</h3>
            <div style="height:280px;">
              <canvas id="pieStatus"></canvas>
            </div>
          </div>

          <div class="card">
            <h3>Distribuição por Criticidade</h3>
            <div style="height:280px;">
              <canvas id="pieCrit"></canvas>
            </div>
          </div>
        </div>

        <div class="grid cols-2">
          <div class="card">
            <h3>Top Hospitais</h3>
            <div style="height:300px;">
              <canvas id="barHospitais"></canvas>
            </div>
          </div>

          <div class="card">
            <h3>Top Responsáveis</h3>
            <div style="height:300px;">
              <canvas id="barResponsaveis"></canvas>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===================== DASH HOSPITAL ===================== -->
    <section id="page-dash-hospital" class="hidden">
      <div class="grid">
        <div class="card">
          <h2>Dashboard por Hospital</h2>
          <p class="muted">Indicadores filtrados por hospital.</p>

          <div style="margin:10px 0;">
            <label for="selHospital">Hospital:</label>
            <select id="selHospital"></select>
          </div>

          <div class="kpis" style="margin-top:10px;">
            <div class="kpi"><div class="t">Total</div><div class="v" id="kh_total">0</div></div>
            <div class="kpi"><div class="t">Tramitados</div><div class="v" id="kh_tram">0</div></div>
            <div class="kpi"><div class="t">Em andamento</div><div class="v" id="kh_and">0</div></div>
            <div class="kpi"><div class="t">Em validação</div><div class="v" id="kh_val">0</div></div>
            <div class="kpi"><div class="t">Pendentes</div><div class="v" id="kh_pend">0</div></div>
          </div>
        </div>

        <div class="grid cols-2">
          <div class="card">
            <h3>Status por Hospital</h3>
            <div style="height:280px;">
              <canvas id="pieStatusHosp"></canvas>
            </div>
          </div>

          <div class="card">
            <h3>Criticidade por Hospital</h3>
            <div style="height:280px;">
              <canvas id="pieCritHosp"></canvas>
            </div>
          </div>
        </div>

        <div class="grid cols-2">
          <div class="card">
            <h3>Top Responsáveis</h3>
            <div style="height:300px;">
              <canvas id="barRespHosp"></canvas>
            </div>
          </div>

          <div class="card">
            <h3>Top Setores</h3>
            <div style="height:300px;">
              <canvas id="barSetorHosp"></canvas>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>
</div>

<footer>
  © 2026 - GTEC Engenharia Clínica
</footer>

<script>
  let data = [];

  let pieStatus, pieCrit, barHosp, barResp;
  let pieStatusHosp, pieCritHosp, barRespHosp, barSetorHosp;

  function showPage(page){
    document.getElementById("page-registros").classList.add("hidden");
    document.getElementById("page-dash-geral").classList.add("hidden");
    document.getElementById("page-dash-hospital").classList.add("hidden");

    document.getElementById("page-" + page).classList.remove("hidden");

    if(page === "dash-geral") renderDashboards();
    if(page === "dash-hospital") renderDashHospital();
  }

  function openGemini(){
    const win = window.open("https://gemini.google.com/app?hl=pt-BR", "gemini", "width=420,height=650,resizable=yes,scrollbars=yes");
    if(win){ win.focus(); }
  }

  document.getElementById("formRegistro").addEventListener("submit", function(e){
    e.preventDefault();

    const registro = {
      hospital: hospital.value.trim(),
      setor: setor.value.trim(),
      status: status.value,
      criticidade: criticidade.value,
      responsavel: responsavel.value.trim(),
      descricao: descricao.value.trim()
    };

    data.push(registro);
    this.reset();
    renderTable();
  });

  function renderTable(){
    const tbody = document.getElementById("tbodyRegistros");
    tbody.innerHTML = "";
    data.forEach(r => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${r.hospital}</td>
        <td>${r.setor}</td>
        <td>${r.status}</td>
        <td>${r.criticidade}</td>
        <td>${r.responsavel}</td>
        <td>${r.descricao}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function normalize(val){
    return (val || "").toString().trim().toLowerCase();
  }

  function mapCounts(arr, field){
    const map = {};
    arr.forEach(r => {
      const key = normalize(r[field]) || "Não informado";
      map[key] = (map[key] || 0) + 1;
    });
    return {
      labels: Object.keys(map).map(k => k.charAt(0).toUpperCase() + k.slice(1)),
      values: Object.values(map)
    };
  }

  function destroyIf(chart){
    if(chart){ chart.destroy(); }
    return null;
  }

  function setKpis(){
    const total = data.length;
    const tram = data.filter(r => r.status === "Tramitado").length;
    const and  = data.filter(r => r.status === "Em andamento").length;
    const val  = data.filter(r => r.status === "Em validação").length;
    const pend = data.filter(r => r.status === "Pendente").length;

    k_total.textContent = total;
    k_tram.textContent = tram;
    k_and.textContent  = and;
    k_val.textContent  = val;
    k_pend.textContent = pend;
  }

  function setHospitalKpis(filtered){
    const total = filtered.length;
    const tram = filtered.filter(r => r.status === "Tramitado").length;
    const and  = filtered.filter(r => r.status === "Em andamento").length;
    const val  = filtered.filter(r => r.status === "Em validação").length;
    const pend = filtered.filter(r => r.status === "Pendente").length;

    kh_total.textContent = total;
    kh_tram.textContent = tram;
    kh_and.textContent  = and;
    kh_val.textContent  = val;
    kh_pend.textContent = pend;
  }

  function renderDashboards(){
    setKpis();

    const st = mapCounts(data, "status");
    const cr = mapCounts(data, "criticidade");
    const h  = mapCounts(data, "hospital");
    const rp = mapCounts(data, "responsavel");

    pieStatus = destroyIf(pieStatus);
    pieCrit   = destroyIf(pieCrit);
    barHosp   = destroyIf(barHosp);
    barResp   = destroyIf(barResp);

    const baseOptions = {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: true, position: "bottom" },
        tooltip: { enabled: true },
        title: { display: false }
      }
    };

    if(document.getElementById("pieStatus")){
      pieStatus = new Chart(document.getElementById("pieStatus"), {
        type:"pie",
        data:{ labels: st.labels, datasets:[{ data: st.values }] },
        options: baseOptions
      });
    }
    if(document.getElementById("pieCrit")){
      pieCrit = new Chart(document.getElementById("pieCrit"), {
        type:"pie",
        data:{ labels: cr.labels, datasets:[{ data: cr.values }] },
        options: baseOptions
      });
    }
    if(document.getElementById("barHospitais")){
      const top = { labels: h.labels.slice(0,10), values: h.values.slice(0,10) };
      barHosp = new Chart(document.getElementById("barHospitais"), {
        type:"bar",
        data:{ labels: top.labels, datasets:[{ data: top.values, label: "Processos" }] },
        options: baseOptions
      });
    }
    if(document.getElementById("barResponsaveis")){
      const top = { labels: rp.labels.slice(0,10), values: rp.values.slice(0,10) };
      barResp = new Chart(document.getElementById("barResponsaveis"), {
        type:"bar",
        data:{ labels: top.labels, datasets:[{ data: top.values, label: "Processos" }] },
        options: baseOptions
      });
    }

    const sel = document.getElementById("selHospital");
    const hospitals = [...new Set(data.map(r => normalize(r.hospital)).filter(Boolean))].sort((a,b)=>a.localeCompare(b));
    sel.innerHTML = "";
    const allOpt = document.createElement("option");
    allOpt.value = "__ALL__";
    allOpt.textContent = hospitals.length ? "Todos" : "Sem hospitais ainda";
    sel.appendChild(allOpt);
    for(const name of hospitals){
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name;
      sel.appendChild(opt);
    }

    renderDashHospital();
  }

  function renderDashHospital(){
    const sel = document.getElementById("selHospital");
    const hospital = sel.value;
    const filtered = hospital==="__ALL__" ? data : data.filter(r => normalize(r.hospital)===hospital);

    setHospitalKpis(filtered);

    const st = mapCounts(filtered, "status");
    const cr = mapCounts(filtered, "criticidade");
    const rp = mapCounts(filtered, "responsavel");
    const se = mapCounts(filtered, "setor");

    pieStatusHosp = destroyIf(pieStatusHosp);
    pieCritHosp   = destroyIf(pieCritHosp);
    barRespHosp   = destroyIf(barRespHosp);
    barSetorHosp  = destroyIf(barSetorHosp);

    const baseOptions = {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: true, position: "bottom" },
        tooltip: { enabled: true },
        title: { display: false }
      }
    };

    if(document.getElementById("pieStatusHosp")){
      pieStatusHosp = new Chart(document.getElementById("pieStatusHosp"), {
        type:"pie",
        data:{ labels: st.labels, datasets:[{ data: st.values }] },
        options: baseOptions
      });
    }
    if(document.getElementById("pieCritHosp")){
      pieCritHosp = new Chart(document.getElementById("pieCritHosp"), {
        type:"pie",
        data:{ labels: cr.labels, datasets:[{ data: cr.values }] },
        options: baseOptions
      });
    }
    if(document.getElementById("barRespHosp")){
      const top = { labels: rp.labels.slice(0,10), values: rp.values.slice(0,10) };
      barRespHosp = new Chart(document.getElementById("barRespHosp"), {
        type:"bar",
        data:{ labels: top.labels, datasets:[{ data: top.values, label: "Processos" }] },
        options: baseOptions
      });
    }
    if(document.getElementById("barSetorHosp")){
      const top = { labels: se.labels.slice(0,10), values: se.values.slice(0,10) };
      barSetorHosp = new Chart(document.getElementById("barSetorHosp"), {
        type:"bar",
        data:{ labels: top.labels, datasets:[{ data: top.values, label: "Processos" }] },
        options: baseOptions
      });
    }
  }

  showPage("registros");
</script>

</body>
</html>
